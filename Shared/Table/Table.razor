@typeparam TModel

<MudTable Loading=@Props.IsLoading 
          Items=@Props.Items 
          Bordered=true 
          Class="!border-black" 
          Height="500px" 
          Striped="true"
          MultiSelection=@Props.IsSelectable
          @bind-SelectedItems="selectedHashSet"
          HorizontalScrollbar=true 
          FixedHeader=true>
    <ColGroup>
        @if (Props.IsSelectable)
        {
            // for select column
            <col style="width: 40px;" />
        }
        @foreach (var column in @Props.Columns)
        {
            <col />
        }
    </ColGroup>
    <HeaderContent>
        @foreach (var column in @Props.Columns)
        {
            <MudTh>
                @if (column.SortSelector is not null)
                {
                    <MudTableSortLabel SortBy=@column.SortSelector>
                        @column.Header
                    </MudTableSortLabel>
                }
                else
                {
                    @column.Header
                }
            </MudTh>
        }
    </HeaderContent>
    <RowTemplate>
        @foreach (var column in @Props.Columns)
        {
            <MudTd DataLabel=@column.Header>@column.ValueSelector(context)</MudTd>
        }
    </RowTemplate>
</MudTable>

@code {
    [Parameter]
    public required TableProps<TModel> Props { get; set; }

    private HashSet<TModel> _selectedHashSet = new HashSet<TModel>();

    private HashSet<TModel> selectedHashSet
    {
        get => _selectedHashSet;
        set
        {
            _selectedHashSet = value;
            Props.SelectedItems = value;
            if (Props.SelectedItemsChanged.HasDelegate)
            {
                Props.SelectedItemsChanged.InvokeAsync(value);
            }
        }
    }

    protected override void OnParametersSet()
    {
        // Sync from Props.SelectedItems to local HashSet
        if (Props.SelectedItems is HashSet<TModel> hashSet)
        {
            _selectedHashSet = hashSet;
        }
        else
        {
            _selectedHashSet = new HashSet<TModel>(Props.SelectedItems);
        }
    }
}